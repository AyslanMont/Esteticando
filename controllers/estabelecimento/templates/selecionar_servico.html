{% extends "base.html" %}

{% block links %}
<link rel="stylesheet" href="{{ url_for('static', filename='styles/selecionar_servico.css') }}">
{% endblock %}

{% block content %}
<main class="container">
  <section class="estabelecimento-header">
    {% if imagem_base64 %}
    <img src="data:image/jpeg;base64,{{ imagem_base64 }}" 
         alt="{{ est_nome }}" 
         class="estabelecimento-logo">
    {% else %}
    <img src="{{ url_for('static', filename='imgs/default-establishment.jpg') }}" 
         alt="Imagem padrão" 
         class="estabelecimento-logo">
    {% endif %}
    
    <div class="estabelecimento-info">
      <h1>{{ est_nome }}</h1>
      {% if est_descricao %}
      <p class="estabelecimento-descricao">{{ est_descricao }}</p>
      {% endif %}
      <div class="rating">
        <!-- Sistema de avaliação -->
        {% for i in range(5) %}
        <span class="star">★</span>
        {% endfor %}
        <span class="rating-text">4.8 (128 avaliações)</span>
      </div>
      {% if is_dono %}
        <div class="acoes-dono">
          <a href="{{ url_for('servico.adicionar_servico', est_id=est_id) }}" class="btn-acao">Cadastrar Serviço</a>
          <a href="{{ url_for('estabelecimento.editar_estabelecimento')}}" class="btn-acao">Editar Estabelecimento</a>
          <a href="{{ url_for('servico.listar_funcionarios', est_id=est_id) }}" class="btn-acao">Cadastrar Funcionário</a>
          <a href="{{ url_for('estabelecimento.agendamentos')}}" class="btn-acao">agendamentos</a>

        </div>
      {% endif %}
    </div>
  </section>
  {% if servicos %}
  <section class="servicos-list">
    <h2>Serviços Disponíveis</h2>
    
    {% for servico in servicos %}
    <div class="servico-card">
      <div class="servico-info">
        <h3>{{ servico.ser_nome }}</h3>
        <p class="servico-preco">R$ {{ "%.2f"|format(servico.ser_preco) }}</p>
        <p class="servico-duracao">{{ servico.ser_duracao }} minutos</p>
        
      </div>
      <div class="servico-actions">
        <a href="{{ url_for('agendamento.agendar', est_id=est_id, ser_id=servico.ser_id) }}" class="btn-agendar">Agendar</a>
        <button class="btn btn-primary btn-avaliar" data-ser-id="{{ servico.ser_id }}" data-bs-toggle="modal" data-bs-target="#modalAvaliacao">
          Avaliar Serviço
        </button>
        
      </div>
    </div>
    {% endfor %}
  </section>
  <div class="modal fade" id="modalAvaliacao" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">

        <form method="POST" action="{{ url_for('avaliacao.cadastrar_avaliacao') }}">
          <div class="modal-header">
            <h5 class="modal-title">Avaliar Serviço</h5>
            <button class="btn-close" data-bs-dismiss="modal"></button>
          </div>

          <div class="modal-body">

            <input type="hidden" name="agendamento_id" value="{{ agendamento_id }}">
            <input type="hidden" name="nota" id="notaSelecionada">

            <label class="form-label">Nota:</label>
            <div id="stars" class="d-flex gap-1 fs-3" style="cursor: pointer;">
              <i class="star bi bi-star" data-value="1"></i>
              <i class="star bi bi-star" data-value="2"></i>
              <i class="star bi bi-star" data-value="3"></i>
              <i class="star bi bi-star" data-value="4"></i>
              <i class="star bi bi-star" data-value="5"></i>
            </div>

            <label class="form-label mt-3">Comentário (opcional):</label>
            <textarea name="comentario" class="form-control"></textarea>

          </div>

          <div class="modal-footer">
            <button class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button class="btn btn-success" type="submit">Enviar Avaliação</button>
          </div>

        </form>

      </div>
    </div>
  </div>
  {% endif %}
</main>
{% endblock %}